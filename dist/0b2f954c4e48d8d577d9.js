/*! For license information please see 0b2f954c4e48d8d577d9.js.LICENSE.txt */
function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){i=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _regenerator(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function o(r,n,a,o){var u=n&&n.prototype instanceof i?n:i,c=Object.create(u.prototype);return _regeneratorDefine2(c,"_invoke",function(r,n,a){var o,i,u,c=0,l=a||[],d=!1,m={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return o=t,i=0,u=e,m.n=r,s}};function f(r,n){for(i=r,u=n,t=0;!d&&c&&!a&&t<l.length;t++){var a,o=l[t],f=m.p,g=o[2];r>3?(a=g===n)&&(u=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=f&&((a=r<2&&f<o[1])?(i=0,m.v=n,m.n=o[1]):f<g&&(a=r<3||o[0]>n||n>g)&&(o[4]=r,o[5]=n,m.n=g,i=0))}if(a||r>1)return s;throw d=!0,n}return function(a,l,g){if(c>1)throw TypeError("Generator is already running");for(d&&1===l&&f(l,g),i=l,u=g;(t=i<2?e:u)||!d;){o||(i?i<3?(i>1&&(m.n=-1),f(i,u)):m.n=u:m.v=u);try{if(c=2,o){if(i||(a="next"),t=o[a]){if(!(t=t.call(o,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=o.return)&&t.call(o),i<2&&(u=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((t=(d=m.n<0)?u:r.call(n,m))!==s)break}catch(t){o=e,i=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,a,o),!0),c}var s={};function i(){}function u(){}function c(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(_regeneratorDefine2(t={},n,function(){return this}),t),d=c.prototype=i.prototype=Object.create(l);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,_regeneratorDefine2(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,_regeneratorDefine2(d,"constructor",c),_regeneratorDefine2(c,"constructor",u),u.displayName="GeneratorFunction",_regeneratorDefine2(c,a,"GeneratorFunction"),_regeneratorDefine2(d),_regeneratorDefine2(d,a,"Generator"),_regeneratorDefine2(d,n,function(){return this}),_regeneratorDefine2(d,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:o,m:m}})()}function _regeneratorDefine2(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}_regeneratorDefine2=function(e,t,r,n){function o(t,r){_regeneratorDefine2(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))},_regeneratorDefine2(e,t,r,n)}function asyncGeneratorStep(e,t,r,n,a,o,s){try{var i=e[o](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,a)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function s(e){asyncGeneratorStep(o,n,a,s,i,"next",e)}function i(e){asyncGeneratorStep(o,n,a,s,i,"throw",e)}s(void 0)})}}var STORAGE={MODE:"wc_mode",TARGET:"wc_target",RANGE_MIN:"wc_range_min",RANGE_MAX:"wc_range_max",DELTA_TARGET:"wc_delta_target",BASELINE:"wc_baseline",STATS:"wc_stats_v1",MILESTONES:"wc_milestones_v1",MOMENTUM_ENABLED:"wc_momentum_enabled"},REFRESH_MS=1e3,MOMENTUM_WINDOW_SEC=60,refreshTimer=null,momentumHistory=[],momentumEnabled=!1,session={active:!1,startTs:null,startWords:null,added:0,removed:0},lastCount=null,confetti=null,lastGlowWordCount=null,glowUntilTs=0,glowCooldownUntilTs=0;function wireUI(){var e=document.getElementById("openSettings"),t=document.getElementById("closeSettings"),r=document.getElementById("settingsBackdrop");e.addEventListener("click",function(){return toggleSettings(!0)}),t.addEventListener("click",function(){return toggleSettings(!1)}),r.addEventListener("click",function(){return toggleSettings(!1)}),document.getElementById("saveMode").addEventListener("click",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=document.getElementById("mode").value,e.n=1,setItem(STORAGE.MODE,t);case 1:return e.n=2,applyModeVisibility(t);case 2:return e.n=3,updateUI();case 3:return e.a(2)}},e)}))),document.getElementById("saveTarget").addEventListener("click",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(isValidPositiveInt(t=parseInt(document.getElementById("target").value,10))){e.n=1;break}return e.a(2,setStatus("Enter a valid target (> 0)."));case 1:return e.n=2,setItem(STORAGE.TARGET,String(t));case 2:return e.n=3,updateUI();case 3:return e.a(2)}},e)}))),document.getElementById("saveRange").addEventListener("click",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(t=parseInt(document.getElementById("rangeMin").value,10),r=parseInt(document.getElementById("rangeMax").value,10),Number.isFinite(t)&&!(t<0)){e.n=1;break}return e.a(2,setStatus("Range min must be 0 or higher."));case 1:if(isValidPositiveInt(r)){e.n=2;break}return e.a(2,setStatus("Range max must be > 0."));case 2:if(!(r<=t)){e.n=3;break}return e.a(2,setStatus("Range max must be greater than range min."));case 3:return e.n=4,setItem(STORAGE.RANGE_MIN,String(t));case 4:return e.n=5,setItem(STORAGE.RANGE_MAX,String(r));case 5:return e.n=6,updateUI();case 6:return e.a(2)}},e)}))),document.getElementById("saveDelta").addEventListener("click",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(isValidPositiveInt(t=parseInt(document.getElementById("deltaTarget").value,10))){e.n=1;break}return e.a(2,setStatus("Enter a valid delta target (> 0)."));case 1:return e.n=2,setItem(STORAGE.DELTA_TARGET,String(t));case 2:return e.n=3,updateUI();case 3:return e.a(2)}},e)}))),document.getElementById("refresh").addEventListener("click",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)if(0===e.n)return e.a(2,updateUI())},e)}))),document.getElementById("baseline").addEventListener("click",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,getCurrentWordCount();case 1:return t=e.v,e.n=2,setItem(STORAGE.BASELINE,String(t));case 2:return setStatus("Baseline reset to ".concat(t,".")),e.n=3,updateUI();case 3:return e.a(2)}},e)}))),document.getElementById("toggleMomentum").addEventListener("click",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return momentumEnabled=!momentumEnabled,e.n=1,setItem(STORAGE.MOMENTUM_ENABLED,momentumEnabled?"1":"0");case 1:return momentumEnabled||(momentumHistory=[],setText("wpm","—")),renderMomentumButton(),e.n=2,updateUI();case 2:return e.a(2)}},e)}))),document.getElementById("sessionBtn").addEventListener("click",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(session.active){e.n=2;break}return e.n=1,startSession();case 1:e.n=3;break;case 2:return e.n=3,stopSession();case 3:return e.n=4,updateUI();case 4:return e.a(2)}},e)}))),document.getElementById("resetStats").addEventListener("click",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,setItem(STORAGE.STATS,JSON.stringify(defaultStats()));case 1:return e.n=2,renderStats();case 2:setStatus("Personal records reset.");case 3:return e.a(2)}},e)})))}function bootstrap(){return _bootstrap.apply(this,arguments)}function _bootstrap(){return(_bootstrap=_asyncToGenerator(_regenerator().m(function e(){var t,r,n,a,o,s,i,u,c;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,getItem(STORAGE.MODE);case 1:if(c=e.v){e.n=2;break}c="absolute";case 2:return t=c,document.getElementById("mode").value=t,e.n=3,getInt(STORAGE.TARGET);case 3:return(r=e.v)&&(document.getElementById("target").value=String(r)),e.n=4,getInt(STORAGE.RANGE_MIN);case 4:return n=e.v,e.n=5,getInt(STORAGE.RANGE_MAX);case 5:return a=e.v,Number.isFinite(n)&&(document.getElementById("rangeMin").value=String(n)),Number.isFinite(a)&&(document.getElementById("rangeMax").value=String(a)),e.n=6,getInt(STORAGE.DELTA_TARGET);case 6:return(o=e.v)&&(document.getElementById("deltaTarget").value=String(o)),e.n=7,getItem(STORAGE.STATS);case 7:if(e.v){e.n=8;break}return e.n=8,setItem(STORAGE.STATS,JSON.stringify(defaultStats()));case 8:return e.n=9,getItem(STORAGE.MILESTONES);case 9:if(e.v){e.n=10;break}return e.n=10,setItem(STORAGE.MILESTONES,JSON.stringify({}));case 10:return e.n=11,getItem(STORAGE.MOMENTUM_ENABLED);case 11:return s=e.v,momentumEnabled="1"===s,renderMomentumButton(),e.n=12,applyModeVisibility(t);case 12:return e.n=13,renderStats();case 13:return e.n=14,getInt(STORAGE.BASELINE);case 14:if(i=e.v,Number.isFinite(i)){e.n=16;break}return e.n=15,getCurrentWordCount().catch(function(){return null});case 15:if(u=e.v,!Number.isFinite(u)){e.n=16;break}return e.n=16,setItem(STORAGE.BASELINE,String(u));case 16:return confetti=new Confetti(document.getElementById("confetti")),e.n=17,updateUI();case 17:startAutoRefresh();case 18:return e.a(2)}},e)}))).apply(this,arguments)}function startAutoRefresh(){refreshTimer&&clearInterval(refreshTimer),refreshTimer=setInterval(function(){return updateUI().catch(function(){})},REFRESH_MS)}function toggleSettings(e){document.getElementById("settingsDrawer").classList.toggle("hidden",!e),document.getElementById("settingsBackdrop").classList.toggle("hidden",!e)}function renderMomentumButton(){document.getElementById("toggleMomentum").textContent=momentumEnabled?"Stop momentum":"Start momentum"}function isValidPositiveInt(e){return Number.isFinite(e)&&e>0}function applyModeVisibility(e){return _applyModeVisibility.apply(this,arguments)}function _applyModeVisibility(){return(_applyModeVisibility=_asyncToGenerator(_regenerator().m(function e(t){var r,n,a;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:r=document.getElementById("targetRow"),n=document.getElementById("rangeRow"),a=document.getElementById("deltaRow"),r.classList.add("hidden"),n.classList.add("hidden"),a.classList.add("hidden"),"absolute"===t&&r.classList.remove("hidden"),"range"===t&&n.classList.remove("hidden"),"delta"===t&&a.classList.remove("hidden");case 1:return e.a(2)}},e)}))).apply(this,arguments)}function getCurrentWordCount(){return _getCurrentWordCount.apply(this,arguments)}function _getCurrentWordCount(){return _getCurrentWordCount=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)if(0===e.n)return e.a(2,Word.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(t){var r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return(r=t.document.body).load("text"),e.n=1,t.sync();case 1:return e.a(2,countWords(r.text||""))}},e)}));return function(t){return e.apply(this,arguments)}}()))},e)})),_getCurrentWordCount.apply(this,arguments)}function countWords(e){var t=(e||"").replace(/\u00A0/g," ").replace(/[^\S\r\n]+/g," ").trim();return t?t.split(/\s+/).filter(function(e){return/[A-Za-z0-9À-ÖØ-öø-ÿ]/.test(e)}).length:0}function nowMs(){return Date.now()}function clamp(e,t,r){return Math.max(t,Math.min(r,e))}function updateUI(){return _updateUI.apply(this,arguments)}function _updateUI(){return(_updateUI=_asyncToGenerator(_regenerator().m(function e(){var t,r,n,a,o;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,getItem(STORAGE.MODE);case 1:if(o=e.v){e.n=2;break}o="absolute";case 2:return t=o,e.n=3,getCurrentWordCount();case 3:return r=e.v,n=nowMs(),null==lastGlowWordCount&&(lastGlowWordCount=r),r>lastGlowWordCount&&n>=glowCooldownUntilTs&&(glowUntilTs=n+450,glowCooldownUntilTs=n+1e3),lastGlowWordCount=r,trackSessionEdits(r),momentumEnabled&&pushHistory(r),e.n=4,computeProgress(t,r);case 4:return a=e.v,setText("currentWords",String(r)),setText("targetWords",a.targetText),setText("percent",a.percentText),setText("targetLabel",a.targetLabel),renderProgressBar(a),renderWpm(),setStatus(a.statusLine),e.n=5,handleMilestones(t,r,a);case 5:return e.n=6,renderStats();case 6:return e.a(2)}},e)}))).apply(this,arguments)}function setText(e,t){var r=document.getElementById(e);r&&(r.textContent=t)}function setStatus(e){var t=document.getElementById("status");t&&(t.textContent=e)}function renderProgressBar(e){var t=document.getElementById("bar");if(t){t.style.width="".concat(e.visualPercent.toFixed(1),"%"),t.style.backgroundColor=e.barColor;var r=nowMs();t.classList.toggle("adding",r<glowUntilTs)}}function renderWpm(){var e=document.getElementById("wpm");if(e)if(momentumEnabled){var t=computeWordsPerMinute();Number.isFinite(t)?e.textContent=t.toFixed(1):e.textContent="…"}else e.textContent="—"}function pushHistory(e){var t=Math.floor(nowMs()/1e3);Array.isArray(momentumHistory)||(momentumHistory=[]);for(var r=momentumHistory.length-1;r>=0;r--){var n=momentumHistory[r];n&&"number"==typeof n.t&&"number"==typeof n.words||momentumHistory.splice(r,1)}var a=momentumHistory.length?momentumHistory[momentumHistory.length-1]:null;for(a&&a.t===t?a.words=e:momentumHistory.push({t:t,words:e});momentumHistory.length;){var o=momentumHistory[0];if(o&&"number"==typeof o.t){if(t-o.t<=MOMENTUM_WINDOW_SEC)break;momentumHistory.shift()}else momentumHistory.shift()}}function computeWordsPerMinute(){if(!Array.isArray(momentumHistory)||momentumHistory.length<2)return NaN;var e=momentumHistory[0],t=momentumHistory[momentumHistory.length-1];if(!e||!t||"number"!=typeof e.t||"number"!=typeof t.t)return NaN;var r=t.t-e.t;return r<=0?NaN:(t.words-e.words)/r*60}function trackSessionEdits(e){if(session.active)if(null!=lastCount){var t=e-lastCount;t>0&&(session.added+=t),t<0&&(session.removed+=Math.abs(t)),lastCount=e}else lastCount=e;else lastCount=e}function startSession(){return _startSession.apply(this,arguments)}function _startSession(){return(_startSession=_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,getCurrentWordCount();case 1:t=e.v,session={active:!0,startTs:nowMs(),startWords:t,added:0,removed:0},document.getElementById("sessionBtn").textContent="Stop session",setStatus("Session started.");case 2:return e.a(2)}},e)}))).apply(this,arguments)}function stopSession(){return _stopSession.apply(this,arguments)}function _stopSession(){return(_stopSession=_asyncToGenerator(_regenerator().m(function e(){var t,r,n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=nowMs()-session.startTs,r=session.added-session.removed,n=t>0?r/(t/6e4):NaN,e.n=1,updateRecords({netWords:r,paceWpm:n,durationMs:t});case 1:session.active=!1,document.getElementById("sessionBtn").textContent="Start session",setStatus("Session complete: +".concat(session.added," −").concat(session.removed," (net ").concat(r>=0?"+":"").concat(r,")."));case 2:return e.a(2)}},e)}))).apply(this,arguments)}function computeProgress(e,t){return _computeProgress.apply(this,arguments)}function _computeProgress(){return(_computeProgress=_asyncToGenerator(_regenerator().m(function e(t,r){var n,a,o,s,i,u,c,l,d,m,f,g,p,y;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(n="Target",a="—",o="—",s="Set a target to see progress.",i=0,u=0,"absolute"!==t){e.n=3;break}return e.n=1,getInt(STORAGE.TARGET);case 1:if(isValidPositiveInt(c=e.v)){e.n=2;break}return e.a(2,decorateComputed({mode:t,targetLabel:n,targetText:a,percentText:o,statusLine:s,visualPercent:i,pct:u}));case 2:return a=String(c),i=clamp(u=r/c*100,0,100),o="".concat(u.toFixed(1),"%"),s=u<100?"".concat(Math.max(0,c-r)," words remaining."):"Over target by ".concat(r-c,"."),e.a(2,decorateComputed({mode:t,targetLabel:n,targetText:a,percentText:o,statusLine:s,visualPercent:i,pct:u}));case 3:if("range"!==t){e.n=9;break}return e.n=4,getInt(STORAGE.RANGE_MIN);case 4:return l=e.v,e.n=5,getInt(STORAGE.RANGE_MAX);case 5:if(d=e.v,n="Range",Number.isFinite(l)&&isValidPositiveInt(d)&&!(d<=l)){e.n=6;break}return s="Set a valid range (min < max).",e.a(2,decorateComputed({mode:t,targetLabel:n,targetText:a,percentText:o,statusLine:s,visualPercent:i,pct:u}));case 6:if(a="".concat(l,"–").concat(d),!(r<l)){e.n=7;break}return i=clamp(r/Math.max(1,l)*100,0,100),o="".concat(i.toFixed(1),"%"),s="Below range by ".concat(l-r,"."),u=i,e.a(2,decorateComputed({mode:t,targetLabel:n,targetText:a,percentText:o,statusLine:s,visualPercent:i,pct:u}));case 7:if(!(r<=d)){e.n=8;break}return i=clamp(u=(r-l)/(d-l)*100,0,100),o="In range (".concat(i.toFixed(1),"%)"),s="".concat(d-r," words until max."),e.a(2,decorateComputed({mode:t,targetLabel:n,targetText:a,percentText:o,statusLine:s,visualPercent:i,pct:u}));case 8:return i=100,o="Over (".concat(r-d,")"),s="Above range by ".concat(r-d,"."),u=100,e.a(2,decorateComputed({mode:t,targetLabel:n,targetText:a,percentText:o,statusLine:s,visualPercent:i,pct:u}));case 9:if("delta"!==t){e.n=13;break}return n="Delta",e.n=10,getInt(STORAGE.DELTA_TARGET);case 10:return m=e.v,e.n=11,getInt(STORAGE.BASELINE);case 11:if(f=e.v,isValidPositiveInt(m)&&Number.isFinite(f)){e.n=12;break}return a=m?"+".concat(m):"—",s="Set delta target and baseline.",e.a(2,decorateComputed({mode:t,targetLabel:n,targetText:a,percentText:o,statusLine:s,visualPercent:i,pct:u}));case 12:return g=r-f,a="+".concat(m),i=clamp(u=g/m*100,0,100),o="".concat(u.toFixed(1),"%"),s=u<100?"".concat(Math.max(0,m-g)," words remaining."):"Over delta by ".concat(g-m,"."),e.a(2,decorateComputed({mode:t,targetLabel:n,targetText:a,percentText:o,statusLine:s,visualPercent:i,pct:u}));case 13:if("draft"!==t){e.n=16;break}return n="Draft",e.n=14,getInt(STORAGE.BASELINE);case 14:if(p=e.v,Number.isFinite(p)){e.n=15;break}return a="Additions",o="Draft",s="Reset baseline to count additions.",e.a(2,decorateComputed({mode:t,targetLabel:n,targetText:a,percentText:o,statusLine:s,visualPercent:i,pct:u}));case 15:return y=Math.max(0,r-p),a="".concat(y," added"),o="Draft",i=clamp(y/1e3*100,0,100),u=i,s=y<200?"Drafting: keep moving.":"Drafting: good output.",e.a(2,decorateComputed({mode:t,targetLabel:n,targetText:a,percentText:o,statusLine:s,visualPercent:i,pct:u}));case 16:return e.a(2,decorateComputed({mode:t,targetLabel:n,targetText:a,percentText:o,statusLine:s,visualPercent:i,pct:u}))}},e)}))).apply(this,arguments)}function decorateComputed(e){var t=getColourForPercent(e.mode,e.pct);return _objectSpread(_objectSpread({},e),{},{barColor:t})}function getColourForPercent(e,t){return"draft"===e?t<30?"#4aa3ff":"#39d98a":t<50?"#ff4d4d":t<80?"#ffb020":t<100?"#4aa3ff":"#39d98a"}function handleMilestones(e,t,r){return _handleMilestones.apply(this,arguments)}function _handleMilestones(){return(_handleMilestones=_asyncToGenerator(_regenerator().m(function e(t,r,n){var a,o,s,i;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(confetti){e.n=1;break}return e.a(2);case 1:if("absolute"===t||"delta"===t||"range"===t){e.n=2;break}return e.a(2);case 2:if(n.pct>=100){e.n=3;break}return e.a(2);case 3:return s=JSON,e.n=4,getItem(STORAGE.MILESTONES);case 4:if(i=e.v){e.n=5;break}i="{}";case 5:if(a=s.parse.call(s,i),o="".concat(t,"|pct_100"),!a[o]){e.n=6;break}return e.a(2);case 6:return a[o]=nowMs(),e.n=7,setItem(STORAGE.MILESTONES,JSON.stringify(a));case 7:confetti.burst(1100);case 8:return e.a(2)}},e)}))).apply(this,arguments)}function defaultStats(){return{bestNet:0,bestPace:0,bestDuration:0}}function getStats(){return _getStats.apply(this,arguments)}function _getStats(){return(_getStats=_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,getItem(STORAGE.STATS);case 1:return t=e.v,e.p=2,e.a(2,t?JSON.parse(t):defaultStats());case 3:return e.p=3,e.v,e.a(2,defaultStats())}},e,null,[[2,3]])}))).apply(this,arguments)}function formatDuration(e){var t=Math.max(0,Math.floor(e/1e3)),r=Math.floor(t/60),n=t%60;return"".concat(r,"m ").concat(String(n).padStart(2,"0"),"s")}function updateRecords(e){return _updateRecords.apply(this,arguments)}function _updateRecords(){return(_updateRecords=_asyncToGenerator(_regenerator().m(function e(t){var r,n,a,o,s;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return r=t.netWords,n=t.paceWpm,a=t.durationMs,e.n=1,getStats();case 1:if(o=e.v,s=!1,Number.isFinite(r)&&r>(o.bestNet||0)&&(o.bestNet=r,s=!0),Number.isFinite(n)&&n>(o.bestPace||0)&&(o.bestPace=n,s=!0),Number.isFinite(a)&&a>(o.bestDuration||0)&&(o.bestDuration=a,s=!0),!s){e.n=2;break}return e.n=2,setItem(STORAGE.STATS,JSON.stringify(o));case 2:return e.a(2)}},e)}))).apply(this,arguments)}function renderStats(){return _renderStats.apply(this,arguments)}function _renderStats(){return(_renderStats=_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,getStats();case 1:t=e.v,setText("bestNet",Number.isFinite(t.bestNet)?"".concat(t.bestNet):"—"),setText("bestPace",Number.isFinite(t.bestPace)?"".concat(t.bestPace.toFixed(1)," wpm"):"—"),setText("bestDuration",Number.isFinite(t.bestDuration)?formatDuration(t.bestDuration):"—");case 2:return e.a(2)}},e)}))).apply(this,arguments)}function getItem(e){return _getItem.apply(this,arguments)}function _getItem(){return(_getItem=_asyncToGenerator(_regenerator().m(function e(t){return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,"undefined"==typeof OfficeRuntime||!OfficeRuntime.storage){e.n=2;break}return e.n=1,OfficeRuntime.storage.getItem(t);case 1:return e.a(2,e.v);case 2:e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2,localStorage.getItem(t))}},e,null,[[0,3]])}))).apply(this,arguments)}function setItem(e,t){return _setItem.apply(this,arguments)}function _setItem(){return(_setItem=_asyncToGenerator(_regenerator().m(function e(t,r){return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,"undefined"==typeof OfficeRuntime||!OfficeRuntime.storage){e.n=2;break}return e.n=1,OfficeRuntime.storage.setItem(t,r);case 1:return e.a(2);case 2:e.n=4;break;case 3:e.p=3,e.v;case 4:localStorage.setItem(t,r);case 5:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function getInt(e){return _getInt.apply(this,arguments)}function _getInt(){return(_getInt=_asyncToGenerator(_regenerator().m(function e(t){var r,n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,getItem(t);case 1:return r=e.v,n=parseInt(r,10),e.a(2,Number.isFinite(n)?n:null)}},e)}))).apply(this,arguments)}Office.onReady(function(e){e.host===Office.HostType.Word&&(wireUI(),bootstrap().catch(function(e){return setStatus("Init error: ".concat((null==e?void 0:e.message)||e))}))});var Confetti=function(){return _createClass(function e(t){var r=this;_classCallCheck(this,e),this.canvas=t,this.ctx=t.getContext("2d"),this.particles=[],this.running=!1,this.resize(),window.addEventListener("resize",function(){return r.resize()})},[{key:"resize",value:function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}},{key:"burst",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:900;this.canvas.style.display="block";for(var r=nowMs(),n=this.canvas.width,a=this.canvas.height,o=0;o<120;o++)this.particles.push({x:n*(.2+.6*Math.random()),y:a*(.15+.2*Math.random()),vx:6*(Math.random()-.5),vy:7*(Math.random()-1.2),g:.18+.1*Math.random(),size:3+4*Math.random(),rot:Math.random()*Math.PI,vr:.2*(Math.random()-.5),life:600+400*Math.random()});if(!this.running){this.running=!0;var s=function(){var n=nowMs();e.step(16),e.draw(),e.particles=e.particles.filter(function(e){return e.life>0}),n-r<t||e.particles.length?requestAnimationFrame(s):(e.running=!1,e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),e.canvas.style.display="none")};requestAnimationFrame(s)}}},{key:"step",value:function(e){var t,r=_createForOfIteratorHelper(this.particles);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.life-=e,n.vy+=n.g,n.x+=n.vx,n.y+=n.vy,n.rot+=n.vr,n.vx*=.99,n.vy*=.99}}catch(e){r.e(e)}finally{r.f()}}},{key:"draw",value:function(){var e=this.ctx;e.clearRect(0,0,this.canvas.width,this.canvas.height),e.save(),e.globalAlpha=.9;var t,r=_createForOfIteratorHelper(this.particles);try{for(r.s();!(t=r.n()).done;){var n=t.value;e.save(),e.translate(n.x,n.y),e.rotate(n.rot),e.fillStyle="rgba(255,255,255,".concat(.35+.35*Math.random(),")"),e.fillRect(-n.size/2,-n.size/2,n.size,.65*n.size),e.restore()}}catch(e){r.e(e)}finally{r.f()}e.restore()}}])}();